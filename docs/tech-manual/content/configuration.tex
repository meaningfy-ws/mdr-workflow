\section{Configuration}
\label{sec:configuration}
At deployment and at runtime, the service configurations are provided through OS environment variables available in the \textit{.env} file. The role of the \textit{.env} file is to enable the system administrators to easily change default configurations as necessary in the context of their environment.

The suite of micro-services is built, started and shut down via Makefile commands.

In order to avoid hard coding parameters, they are defined externally in the \textit{.env}. Having them in a single file makes  sense and it is more pragmatic, as you can see and manage all parameters in one place, add the file to the version control system (the contents of the file will evolve and be in sync with the actual code) and have different files for different environments.

The following sections describe the configuration options available for each of the services.

\subsection{RDF differ}

The RDF differ application exposes an API and an UI and depends on a dedicated triple store. The RDF diff API is the core service providing the RDF diffing functionality. The URL and port are described below, as well as the request timeout:

\begin{longtable}[c]{@{}p{3.5cm}p{3.5cm}l@{}}
	\toprule
	Description                       & Value            & Associated variable            \\* \midrule
	\endfirsthead
	%
	\multicolumn{3}{c}%
	{{\bfseries Table \thetable\ continued from previous page}}                           \\
	\endhead
	%
	\bottomrule
	\endfoot
	%
	\endlastfoot
	%
	Service URL                       & http://localhost & RDF\_DIFFER\_API\_LOCATION     \\
	Service API port                  & 4030             & RDF\_DIFFER\_API\_PORT         \\
	Is in debug mode                  & True             & RDF\_DIFFER\_DEBUG             \\
	Service UI port                   & 8030             & RDF\_DIFFER\_UI\_PORT          \\
	Web server worker process timeout & 1200             & RDF\_DIFFER\_GUNICORN\_TIMEOUT \\* \bottomrule
	\caption{RDF differ configurations}
	\label{tab:my-table1}                                                                 \\
\end{longtable}

\subsection{Celery worker}
Celery is a simple, flexible, and reliable distributed system to process vast amounts of messages, while providing operations with the tools required to maintain such a system. Itâ€™s a task queue with focus on real-time processing.

In the rdf differ project it serves the purpose of enabling multiprocessing of both diff creation and report generation.

The RDF differ application uses the following Celery environment variables

\begin{longtable}[c]{@{}p{3.5cm}p{3.5cm}l@{}}
	\toprule
	Description    & Value                      & Associated variable          \\* \midrule
	\endfirsthead
	%
	\multicolumn{3}{c}%
	{{\bfseries Table \thetable\ continued from previous page}}                \\
	\endhead
	%
	\bottomrule
	\endfoot
	%
	\endlastfoot
	%
	Redis location & \texttt{redis://localhost} & RDF\_DIFFER\_REDIS\_LOCATION \\
	Redis port     & 6379                       & RDF\_DIFFER\_REDIS\_PORT     \\*\bottomrule
	\caption{Celery environment configurations}
	\label{tab:celery-env}                                                     \\
\end{longtable}

More about the implementation of multiprocessing can be found in the \textit{adapters/celery.py}. A fragment of how celery is used and the asynchronous diff creation is presented below:

\begin{lstlisting}
celery_worker = Celery('rdf-differ-tasks', broker=RDF_DIFFER_REDIS_SERVICE, backend=RDF_DIFFER_REDIS_SERVICE)

CELERY_CREATE_DIFF = 'create_diff'

@celery_worker.task(name=CELERY_CREATE_DIFF, bind=True)
def async_create_diff(...):
	...
\end{lstlisting}

\subsection{Configure and read logs}
Every service provided by the rdf differ has it's own log history and is configurable through the aforementioned \textit{.env} file. The current configuration accepts a relative path to where the logs to be written \textit{logs/api.log}, for example.

\subsubsection{API log example}
\begin{lstlisting}
[2021-12-01 15:54:39 +0000] [7] [INFO] Starting gunicorn 20.1.0
[2021-12-01 15:54:39 +0000] [7] [DEBUG] Arbiter booted
[2021-12-01 15:54:39 +0000] [7] [INFO] Listening at: http://0.0.0.0:4030 (7)
[2021-12-01 15:54:39 +0000] [7] [INFO] Using worker: sync
[2021-12-01 15:54:39 +0000] [9] [INFO] Booting worker with pid: 9
[2021-12-01 15:54:39 +0000] [10] [INFO] Booting worker with pid: 10
[2021-12-01 15:54:39 +0000] [7] [DEBUG] 2 workers
[2021-12-01 15:55:13 +0000] [9] [DEBUG] GET /diffs
[2021-12-01 15:55:13 +0000] [9] [DEBUG] start get diffs endpoint
[2021-12-01 15:55:13 +0000] [9] [DEBUG] finish get diffs endpoint
\end{lstlisting}

\subsubsection{UI log example}
\begin{lstlisting}
[2021-12-01 15:55:21 +0000] [10] [DEBUG] GET /tasks
[2021-12-01 15:55:21 +0000] [10] [DEBUG] request active tasks view
[2021-12-01 15:55:22 +0000] [10] [DEBUG] render active tasks view
\end{lstlisting}

The RDF differ application uses the following environment variables to define logs location:

\begin{longtable}[c]{@{}p{3.5cm}p{3.5cm}l@{}}
	\toprule
	Description & Value           & Associated variable         \\* \midrule
	\endfirsthead
	%
	\multicolumn{3}{c}%
	{{\bfseries Table \thetable\ continued from previous page}} \\
	\endhead
	%
	\bottomrule
	\endfoot
	%
	\endlastfoot
	%
	API logs    & logs/api.log    & RDF\_DIFFER\_API\_LOGS      \\
	UI logs     & logs/ui.log     & RDF\_DIFFER\_UI\_LOGS       \\
	Celery logs & logs/celery.log & RDF\_DIFFER\_CELERY\_LOGS   \\* \bottomrule
	\caption{RDF differ log configurations}
	\label{tab:rdf-differ-log}                                  \\
\end{longtable}
