\section{API documentation}

\subsection{Get application profiles}
\label{api:get-aps}
Get application profiles names and their SHACL shapes files.

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL           & ACTION                                      \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/aps} & \texttt{GET}                                \\* \bottomrule
  \label{tab:rdf-validator-get-aps}                           \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
[
  {
      "application_profile": "main",
      "shapes_files": [
          "skosShapes.shapes.ttl",
          "euvocShapes.shapes.ttl",
          "extensionShapes.shapes.ttl"
      ]
  }
]
\end{lstlisting}

\subsection{Get all validation reports}
List the existent validation reports and the metadata about the validation.

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                   & ACTION                              \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/validations} & \texttt{GET}                        \\* \bottomrule
  \label{tab:rdf-validator-all-validations}                   \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
[
  {
      "application_profile": "",
      "created_at": "09-Jan-2022T16:42:02",
      "custom_html_report": "custom.html",
      "custom_json_report": "custom.json",
      "file": "/usr/src/app/db/7d5a0396-7fbc-4d86-b84b-261f306f20a0/777a3696-637f-4f41-83f4-47b2062b83cbcourts-source-ap.rdf",
      "graphs": null,
      "html_report": "report.html",
      "shacl_shape_files": [
          "/usr/src/app/db/7d5a0396-7fbc-4d86-b84b-261f306f20a0/dfeaa507-6c93-4418-839b-1441d2aaa9bfskosShapes.shapes.ttl",
          "/usr/src/app/db/7d5a0396-7fbc-4d86-b84b-261f306f20a0/e1657ec9-88d2-4979-bb87-ccec352b570aeuvocShapes.shapes.ttl"
      ],
      "ttl_report": "report.ttl",
      "type": "file",
      "uid": "31ada0d2-b822-46b5-96b5-0d3c8d067ddf",
      "url": "",
      "zip_report": "report.zip"
  },
  {
      "application_profile": "main",
      "created_at": "09-Jan-2022T16:37:04",
      "custom_html_report": "custom.html",
      "custom_json_report": "custom.json",
      "file": "/usr/src/app/db/96e0e5db-7b82-4e64-aede-f65ce5a5f19b/6bf7bf64-c82c-4333-85a1-cbb395687625filetypes-source-ap.rdf",
      "graphs": null,
      "html_report": "report.html",
      "shacl_shape_files": [
          "/usr/src/app/resources/aps/main/skosShapes.shapes.ttl",
          "/usr/src/app/resources/aps/main/euvocShapes.shapes.ttl",
          "/usr/src/app/resources/aps/main/extensionShapes.shapes.ttl"
      ],
      "ttl_report": "report.ttl",
      "type": "file",
      "uid": "c53a0f42-653f-43f8-9768-532dcada4b47",
      "url": "",
      "zip_report": "report.zip"
  }
]
\end{lstlisting}

\subsection{Get validation report}
Get specific HTML, JSON, TTL or ZIP (all report types in a zipped file) report.

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                                      & ACTION           \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/validations/\{validation\_id\}} & \texttt{GET}     \\* \bottomrule
  \label{tab:rdf-validator-get-validation-report}             \\
\end{longtable}

\subsubsection{Parameters}
\begin{longtable}[c]{@{}p{4.5cm}p{10cm}l@{}}
  \toprule
  Name                    & Description                                                        \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}}                                  \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{validation\_id} & validation unique id                                               \\
  \texttt{report\_type}   & type of report requested. accepted values: html, json, ttl and zip \\* \bottomrule
  \label{tab:rdf-validator-get-validation-parameters}                                          \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}

Report successfully retrieved.

\textit{Note:} selecting the \texttt{zip} report extension the file will contain the following files:
\begin{itemize}
  \item \texttt{custom.html} - custom HTML report generated by the template found in \texttt{resources\slash templates}.
  \item \texttt{custom.json} - custom JSON report generated by the template found in \texttt{resources\slash templates}.
  \item \texttt{report.html} - HTML report generated by RDFUnit
  \item \texttt{report.ttl} - TTL report generated by RDFUnit
\end{itemize}


\textbf{\texttt{422}}
\begin{lstlisting}
{
  "detail": "Wrong report_extension format. Accepted formats: ttl, html, json, zip",
  "status": 422,
  "title": "Unprocessable Entity",
  "type": "about:blank"
}
\end{lstlisting}

The flow to retrieve a validation report is as follows:
\begin{enumerate}
  \item send a request to on of the validation endpoints
  \item use the UID provided in the response to retrieve the report by calling the \texttt{/validations/\{UID\}?report\_type=\{type\}} endpoint
\end{enumerate}

\textit{Note:} This request just retrieves the reports, it doesn't regenerate them. 
If the original data used in the validation suffered modifications, step 1. has to be run again.

\subsection{Delete validation report}
Delete specific validation

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                                      & ACTION           \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/validations/\{validation\_id\}} & \texttt{DELETE}  \\* \bottomrule
  \label{tab:rdf-validator-delete-validation}                 \\
\end{longtable}

\subsubsection{Parameters}
\begin{longtable}[c]{@{}p{4.5cm}p{10cm}l@{}}
  \toprule
  Name                    & Description                       \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{validation\_id} & validation unique id              \\* \bottomrule
  \label{tab:rdf-validator-delete-validation-parameters}      \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
{
  "message": "Validation with c53a0f42-653f-43f8-9768-532dcada4b47 successfully removed"
}
\end{lstlisting}

\textbf{\texttt{404}}
\begin{lstlisting}
{
  "detail": "Validation with c53a0f42-653f-43f8-9768-532dcada4b47 doesn't exist",
  "status": 404,
  "title": "Not Found",
  "type": "about:blank"
}
\end{lstlisting}

\subsection{Delete all validation reports}
Delete all validations

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                      & ACTION                           \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/remove-reports} & \texttt{DELETE}                  \\* \bottomrule
  \label{tab:rdf-validator-delete-validations}                \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
{
  "message": "Successfully removed all validations"
}
\end{lstlisting}

\subsection{Validate file}
Validate an RDF file with the provided SHACL shapes.

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                            & ACTION                     \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/validate/shapes/file} & \texttt{POST}              \\* \bottomrule
  \label{tab:rdf-validator-file}                              \\
\end{longtable}

\subsubsection{Body}
\textit{multipart/form-data}
\begin{longtable}[c]{@{}p{4.5cm}p{1.5cm}p{2cm}p{6cm}l@{}}
  \toprule
  Name                                            & Required & Type          & Description                                                               \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}}                                                                                            \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{data\_file}                             & true     & \texttt{file} & The file to be validated.                                                 \\
  \texttt{schema\_file0} - \texttt{schema\_file4} & false    & \texttt{file} & The content of the SHACL shape files defining the validation constraints. \\* \bottomrule
  \label{tab:rdf-validator-file-body}                                                                                                                    \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
{
  "task_id": "1dffa147-d25f-4a6e-a767-b7417b9c0b9e"
}
\end{lstlisting}

\subsection{Validate file with Application Profile}
Validate an RDF file with the provided Application Profile.

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                        & ACTION                         \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/validate/ap/file} & \texttt{POST}                  \\* \bottomrule
  \label{tab:rdf-validator-file-ap}                           \\
\end{longtable}

\subsubsection{Body}
\textit{multipart/form-data}
\begin{longtable}[c]{@{}p{4.5cm}p{1.5cm}p{2cm}p{6cm}l@{}}
  \toprule
  Name                          & Required & Type            & Description                                                                                                             \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}}                                                                                                                          \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{data\_file}           & true     & \texttt{file}   & The file to be validated.                                                                                               \\
  \texttt{application\_profile} & true     & \texttt{string} & The application profile selected for validation. Check section \ref{api:get-aps} to get available application profiles. \\* \bottomrule
  \label{tab:rdf-validator-file-ap-body}                                                                                                                                               \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
{
  "task_id": "1dffa147-d25f-4a6e-a767-b7417b9c0b9e"
}
\end{lstlisting}

\subsection{Validate SPARQL Endpoint}
Validate a SPARQL endpoint with the provided SHACL shapes and optionally restricted to provided graphs.

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                           & ACTION                      \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/validate/shapes/url} & \texttt{POST}               \\* \bottomrule
  \label{tab:rdf-validator-url}                               \\
\end{longtable}

\subsubsection{Body}
\textit{multipart/form-data}
\begin{longtable}[c]{@{}p{4.5cm}p{1.5cm}p{2cm}p{6cm}l@{}}
  \toprule
  Name                                            & Required & Type            & Description                                                               \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}}                                                                                              \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{sparql\_endpoint\_url}                  & true     & \texttt{string} & The endpoint to validate                                                  \\
  \texttt{graphs}                                 & false    & \texttt{array}  & An optional list of named graphs to restrict the scope of the validation  \\
  \texttt{schema\_file0} - \texttt{schema\_file4} & false    & \texttt{file}   & The content of the SHACL shape files defining the validation constraints. \\* \bottomrule
  \label{tab:rdf-validator-url-body}                                                                                                                       \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
{
  "task_id": "1dffa147-d25f-4a6e-a767-b7417b9c0b9e"
}
\end{lstlisting}

\subsection{Validate SPARQL Endpoint with Application Profile}
Validate a SPARQL endpoint with the provided Application Profile and optionally restricted to provided graphs.

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                       & ACTION                          \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/validate/ap/url} & \texttt{POST}                   \\* \bottomrule
  \label{tab:rdf-validator-url-ap}                            \\
\end{longtable}

\subsubsection{Body}
\textit{application/json}
\begin{longtable}[c]{@{}p{4.5cm}p{1.5cm}p{2cm}p{6cm}l@{}}
  \toprule
  Name                           & Required & Type            & Description                                                              \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}}                                                                            \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{sparql\_endpoint\_url} & true     & \texttt{string} & The endpoint to validate                                                 \\
  \texttt{graphs}                & false    & \texttt{array}  & An optional list of named graphs to restrict the scope of the validation \\  \texttt{application\_profile} & true     & \texttt{string} & The application profile selected for validation. Check section \ref{api:get-aps} to get available application profiles. \\* \bottomrule
  \label{tab:rdf-validator-url-ap-body}                                                                                                  \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
{
  "task_id": "1dffa147-d25f-4a6e-a767-b7417b9c0b9e"
}
\end{lstlisting}


\subsection{List active tasks}

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                    & ACTION                             \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/tasks/active} & \texttt{GET}                       \\* \bottomrule
  \label{tab:rdf-validator-get-tasks}                         \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
[
  {
      "acknowledged": true,
      "args": [
          "b1a25374-0bf6-416b-94c3-c63c2e8fe827",
          "/usr/src/app/db/7767c52a-ccdc-400a-a927-41a70d745c48/8d0e2b10-a451-4bac-935c-7bd31d2ed274courts-source-ap.rdf",
          [
              "/usr/src/app/db/7767c52a-ccdc-400a-a927-41a70d745c48/1de6320f-fe6d-4d0b-9363-f485a42018e2skosShapes.shapes.ttl",
              "/usr/src/app/db/7767c52a-ccdc-400a-a927-41a70d745c48/ed9b67d1-dfe1-4880-8962-dc800eec06d6euvocShapes.shapes.ttl"
          ],
          "/usr/src/app/db/7767c52a-ccdc-400a-a927-41a70d745c48"
      ],
      "delivery_info": {
          "exchange": "",
          "priority": 0,
          "redelivered": null,
          "routing_key": "celery"
      },
      "hostname": "celery@1014fd21d778",
      "id": "dfb406f8-d59c-4c73-b332-47b7259e447e",
      "kwargs": {},
      "name": "validate_file",
      "time_start": 1641745019.7248263,
      "type": "validate_file",
      "worker_pid": 28
  }
]
\end{lstlisting}

\textit{Note:} the brief explanation of fields.
\begin{itemize}
  \item \texttt{id} - ID of the task.
  \item \texttt{name} - name of the task, in this case, it is the same as the task \texttt{type}.
  \item \texttt{args} - positional arguments passed to the task.
  \item \texttt{kwargs} - keywords arguments passed to the task.
  \item \texttt{type} - type of the task.
  \item \texttt{hostname} - hostname of the worker that is running the task.
  \item \texttt{acknowledged} - True when task was acknowledged by the broker.
  \item \texttt{delivery\_info}
        \begin{itemize}
          \item \texttt{exchange} - name of the exchange the task was published to
          \item \texttt{priority} - priority of the task
          \item \texttt{redelivered} - True when task was redelivered by the broker
          \item \texttt{routing\_key} - routing key of the task
        \end{itemize}
  \item \texttt{time\_start} - time of the task start.
  \item \texttt{worker\_pid} - PID of the worker that is executing the task.
\end{itemize}

\subsection{Get task status}
Get specific task status

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                          & ACTION                       \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/tasks/\{task\_id\}} & \texttt{GET}                 \\* \bottomrule
  \label{tab:rdf-validator-get-task}                          \\
\end{longtable}

\subsubsection{Parameters}
\begin{longtable}[c]{@{}p{4.5cm}p{10cm}l@{}}
  \toprule
  Name              & Description                             \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{task\_id} & task unique id                          \\* \bottomrule
  \label{tab:rdf-validator-get-task-parameters}               \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
{
  "task_id": "dfb406f8-d59c-4c73-b332-47b7259e447e",
  "task_result": null,
  "task_status": "PENDING"
}
\end{lstlisting}

\textit{Note:} Task statuses and their meanings::
\begin{itemize}
  \item \texttt{FAILURE} - Task failed.
  \item \texttt{PENDING} - Task state is unknown or the task doesn't exist.
  \item \texttt{REVOKED} - Task was revoked.
  \item \texttt{STARTED} - Task was started by a worker.
  \item \texttt{SUCCESS} - Task succeeded.
\end{itemize}


\subsection{Stop task execution}

\begin{longtable}[c]{@{}p{7.5cm}p{7.5cm}l@{}}
  \toprule
  URL                          & ACTION                       \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{/tasks/\{task\_id\}} & \texttt{DELETE}              \\* \bottomrule
  \label{tab:rdf-validator-delete-task}                       \\
\end{longtable}

\subsubsection{Parameters}
\begin{longtable}[c]{@{}p{4.5cm}p{10cm}l@{}}
  \toprule
  Name              & Description                             \\* \midrule
  \endfirsthead
  %
  \multicolumn{3}{c}%
  {{\bfseries Table \thetable\ continued from previous page}} \\
  \endhead
  %
  \bottomrule
  \endfoot
  %
  \endlastfoot
  %
  \texttt{task\_id} & task unique id                          \\* \bottomrule
  \label{tab:rdf-validator-delete-task-parameters}            \\
\end{longtable}

\subsubsection{Response}
\textbf{\texttt{200}}
\begin{lstlisting}
{
  "message": "task 26651a0f-e8ae-490a-b500-ccf7b90080dd set for revoking."
}
\end{lstlisting}

\textbf{\texttt{406}}
\begin{lstlisting}
{
  "detail": "task already finished executing or does not exist",
  "status": 406,
  "title": "Not Acceptable",
  "type": "about:blank"
}
\end{lstlisting}